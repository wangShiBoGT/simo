# Simo 硬件连线方案

## 硬件清单（已有）

| 模块 | 型号 | 数量 | 用途 |
|------|------|------|------|
| 智能小车 | STM32底盘 | 1 | 电机+舵机+传感器 |
| 上位机 | ESP32-S3-N16R8 | 1 | WiFi+AI+摄像头 |
| 摄像头 | OV3660 | 1 | 视觉识别 |
| 麦克风 | INMP441 | 1 | 语音输入 |
| 音频 | 放大器+扬声器 | 1 | 语音输出 |
| 电源 | 5V移动电源 | 1 | Type-C供电 |
| 连接线 | 杜邦线 | 充足 | 各模块连接 |

## 连线图

```
┌─────────────────────────────────────────────────────────────────┐
│                        ESP32-S3-N16R8                           │
│                                                                 │
│  [5V]──────────────────────────────────────[移动电源 Type-C]    │
│  [GND]─────┬────────────────────────────────────────────────────│
│            │                                                    │
│  ┌─────────┴─────────────────────────────────────────────────┐  │
│  │                      GPIO 分配                             │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │ STM32通信 (UART)                                          │  │
│  │   TX (GPIO43) ──────────────────> RX (STM32 PA10)        │  │
│  │   RX (GPIO44) <────────────────── TX (STM32 PA9)         │  │
│  │   GND ────────────────────────── GND                      │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │ OV3660 摄像头 (DVP/SCCB)                                  │  │
│  │   SIOD (GPIO4)  ── SDA                                    │  │
│  │   SIOC (GPIO5)  ── SCL                                    │  │
│  │   VSYNC (GPIO6) ── VSYNC                                  │  │
│  │   HREF (GPIO7)  ── HREF                                   │  │
│  │   PCLK (GPIO13) ── PCLK                                   │  │
│  │   XCLK (GPIO15) ── XCLK                                   │  │
│  │   D0-D7 (GPIO11,9,8,10,12,18,17,16)                       │  │
│  │   PWDN (GPIO38) ── 可选                                   │  │
│  │   RESET (-1)    ── 不使用                                 │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │ INMP441 麦克风 (I2S 输入)                                 │  │
│  │   SCK  (GPIO14) ── 时钟                                   │  │
│  │   WS   (GPIO47) ── 字选择                                 │  │
│  │   SD   (GPIO21) ── 数据输入                               │  │
│  │   VDD  ── 3.3V                                            │  │
│  │   GND  ── GND                                             │  │
│  │   L/R  ── GND (左声道) 或 3.3V (右声道)                   │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │ MAX98357A 放大器 (I2S 输出)                               │  │
│  │   BCLK (GPIO48) ── 位时钟                                 │  │
│  │   LRC  (GPIO45) ── 左右声道时钟                           │  │
│  │   DIN  (GPIO46) ── 数据输出                               │  │
│  │   VIN  ── 5V                                              │  │
│  │   GND  ── GND                                             │  │
│  │   GAIN ── 悬空(9dB) 或 GND(15dB) 或 VIN(12dB)             │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## GPIO 分配总表

| GPIO | 功能 | 模块 | 说明 |
|------|------|------|------|
| 43 | UART TX | STM32 | 发送命令 |
| 44 | UART RX | STM32 | 接收响应 |
| 4 | SIOD | OV3660 | I2C数据 |
| 5 | SIOC | OV3660 | I2C时钟 |
| 6 | VSYNC | OV3660 | 垂直同步 |
| 7 | HREF | OV3660 | 水平参考 |
| 13 | PCLK | OV3660 | 像素时钟 |
| 15 | XCLK | OV3660 | 主时钟 |
| 11,9,8,10,12,18,17,16 | D0-D7 | OV3660 | 数据总线 |
| 38 | PWDN | OV3660 | 省电模式 |
| 14 | I2S_SCK | INMP441 | 麦克风时钟 |
| 47 | I2S_WS | INMP441 | 字选择 |
| 21 | I2S_SD_IN | INMP441 | 音频输入 |
| 48 | I2S_BCLK | MAX98357A | 放大器时钟 |
| 45 | I2S_LRC | MAX98357A | 左右声道 |
| 46 | I2S_DOUT | MAX98357A | 音频输出 |

## 开发路线图

### Phase 1: 基础通信（当前）
- [x] ESP32 WiFi AP
- [x] Web 控制面板
- [x] STM32 串口通信
- [x] OTA 升级
- [ ] 连线测试

### Phase 2: 音频模块
- [ ] INMP441 麦克风驱动
- [ ] MAX98357A 扬声器驱动
- [ ] I2S 双向通信
- [ ] 本地语音播放

### Phase 3: 视觉模块
- [ ] OV3660 摄像头驱动
- [ ] MJPEG 视频流
- [ ] 边界检测
- [ ] 人脸检测预埋

### Phase 4: 智能交互
- [ ] 语音识别（云端/本地）
- [ ] 语音合成（TTS）
- [ ] 对话系统
- [ ] 记忆系统

## 注意事项

1. **供电**
   - ESP32-S3 通过移动电源 Type-C 供电（5V）
   - STM32 独立供电（小车电池组）
   - 两者共地（GND 必须连接）

2. **电平兼容**
   - ESP32-S3 GPIO 电压：3.3V
   - STM32 GPIO 电压：3.3V（兼容）
   - 摄像头/麦克风/放大器：3.3V

3. **I2S 冲突**
   - 麦克风和扬声器使用不同的 I2S 通道
   - ESP32-S3 支持双 I2S 接口

4. **摄像头占用**
   - OV3660 占用大量 GPIO（约12个）
   - 使用 DVP 并行接口，带宽更高
