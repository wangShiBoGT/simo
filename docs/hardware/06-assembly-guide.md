# 06 - 装配指南

> **这是一份"文字版装配图"，照着做就能完成硬件集成。**

---

## 🎯 本文档目标

帮你完成：
1. ITX 主机在机器人中的固定
2. 接线规范
3. 散热设计
4. 调试验证

---

## 📋 装配前检查清单

### 硬件准备

| 组件 | 数量 | 状态 |
|------|------|------|
| STM32F103C8T6 开发板 | 1 | □ |
| L298N 电机驱动板 | 1 | □ |
| TT 马达 | 4 | □ |
| SG90 舵机 | 1 | □ |
| HC-SR04 超声波模块 | 1 | □ |
| 红外避障模块 | 2 | □ |
| 18650 电池 + 电池盒 | 2 | □ |
| USB 转串口模块 (CH340) | 1 | □ |
| 杜邦线若干 | - | □ |
| 小车底盘 | 1 | □ |

### 工具准备

| 工具 | 用途 |
|------|------|
| 螺丝刀 | 固定 |
| 电烙铁 | 焊接（可选） |
| 万用表 | 测试 |
| 热缩管 | 绝缘 |
| 扎带 | 理线 |

---

## 🔧 装配步骤

### 第一步：底盘组装

```
1. 安装四个电机到底盘
   - 注意电机方向一致
   - 拧紧固定螺丝

2. 安装轮子
   - 确保轮子与电机轴配合紧密

3. 安装万向轮（如有）
   - 放在底盘前部或后部
```

**验证点**：
- □ 四个轮子能自由转动
- □ 电机固定牢固

---

### 第二步：电源系统

```
电池盒接线：
┌─────────────────────────────────────┐
│  [18650×2 电池盒]                   │
│       │                             │
│       ├─ 红线(+) ─→ 开关 ─→ L298N VCC│
│       │                             │
│       └─ 黑线(-) ─→ L298N GND       │
│                    ↓                │
│              STM32 GND（共地）      │
└─────────────────────────────────────┘
```

**接线规范**：
1. **红线 = 正极**，**黑线 = 负极**
2. 所有 GND 必须连在一起（共地）
3. 加装开关在正极线上

**验证点**：
- □ 万用表测量电池电压（应为 7.4V 左右）
- □ 开关能正常通断
- □ 无短路

---

### 第三步：电机驱动接线

```
L298N 接线图：
┌─────────────────────────────────────┐
│  L298N 电机驱动板                   │
│                                     │
│  电源部分：                          │
│  VCC ──── 电池正极 (7.4V)           │
│  GND ──── 电池负极                   │
│  5V  ──── 可给 STM32 供电（可选）    │
│                                     │
│  控制部分（接 STM32）：              │
│  IN1 ──── PA0                       │
│  IN2 ──── PA1                       │
│  IN3 ──── PA2                       │
│  IN4 ──── PA3                       │
│  ENA ──── 跳线帽接上（全速）         │
│  ENB ──── 跳线帽接上（全速）         │
│                                     │
│  输出部分（接电机）：                │
│  OUT1 ─┬─ 电机1 红线                │
│  OUT2 ─┘  电机1 黑线                │
│  OUT3 ─┬─ 电机2 红线                │
│  OUT4 ─┘  电机2 黑线                │
└─────────────────────────────────────┘

注意：左侧两个电机并联，右侧两个电机并联
```

**验证点**：
- □ 通电后 L298N 指示灯亮
- □ 无异常发热
- □ 电机不会自己转动

---

### 第四步：STM32 接线

```
STM32F103C8T6 引脚分配：
┌─────────────────────────────────────┐
│  电源：                              │
│  3.3V ──── 内部供电                  │
│  5V   ──── L298N 5V 输出（或 USB）   │
│  GND  ──── 共地                      │
│                                     │
│  电机控制：                          │
│  PA0  ──── L298N IN1                │
│  PA1  ──── L298N IN2                │
│  PA2  ──── L298N IN3                │
│  PA3  ──── L298N IN4                │
│                                     │
│  超声波：                            │
│  PB11 ──── HC-SR04 TRIG             │
│  PB10 ──── HC-SR04 ECHO             │
│                                     │
│  红外：                              │
│  PA4  ──── 左红外 OUT               │
│  PA5  ──── 右红外 OUT               │
│                                     │
│  舵机：                              │
│  PA6  ──── SG90 信号线（橙色）       │
│                                     │
│  串口：                              │
│  PA9  ──── CH340 RXD                │
│  PA10 ──── CH340 TXD                │
└─────────────────────────────────────┘
```

**验证点**：
- □ STM32 上电后 LED 闪烁
- □ 串口能收发数据

---

### 第五步：传感器安装

```
超声波模块安装：
┌─────────────────────────────────────┐
│  1. 将超声波模块固定在舵机上         │
│                                     │
│     ┌─────────────┐                 │
│     │  HC-SR04    │                 │
│     │  ○     ○   │  ← 两个"眼睛"   │
│     └──────┬──────┘                 │
│            │                        │
│     ┌──────┴──────┐                 │
│     │   SG90      │  ← 舵机        │
│     └─────────────┘                 │
│                                     │
│  2. 舵机固定在底盘前部               │
│                                     │
│  3. 接线：                           │
│     VCC ─→ 5V                       │
│     GND ─→ GND                      │
│     TRIG ─→ PB11                    │
│     ECHO ─→ PB10                    │
└─────────────────────────────────────┘

红外模块安装：
┌─────────────────────────────────────┐
│  1. 左右各一个，朝向前下方 45°       │
│                                     │
│     ┌───┐          ┌───┐           │
│     │IR │          │IR │           │
│     │ L │          │ R │           │
│     └─┬─┘          └─┬─┘           │
│       ↘              ↙              │
│         ↘          ↙                │
│           ↘      ↙                  │
│             地面                     │
│                                     │
│  2. 调节灵敏度（旋钮）               │
│     - 检测距离约 10-15cm            │
└─────────────────────────────────────┘
```

**验证点**：
- □ 超声波模块能测距
- □ 红外模块遇障碍时 LED 亮
- □ 舵机能左右转动

---

### 第六步：USB 串口连接

```
CH340 USB 转串口模块：
┌─────────────────────────────────────┐
│  CH340 ──────── STM32               │
│                                     │
│  TXD  ──────── PA10 (RX)            │
│  RXD  ──────── PA9  (TX)            │
│  GND  ──────── GND                  │
│  3.3V ──────── 不接（STM32 自供电） │
│                                     │
│  注意：TXD 接 RX，RXD 接 TX（交叉） │
└─────────────────────────────────────┘
```

**验证点**：
- □ 电脑能识别 COM 口
- □ 串口助手能收发数据

---

## 🌡️ 散热设计

### ITX 主机散热

```
┌─────────────────────────────────────┐
│  散热方案：                          │
│                                     │
│  1. 被动散热（推荐 N100 等低功耗）   │
│     - 选择无风扇主机                 │
│     - 机器人外壳留散热孔             │
│                                     │
│  2. 主动散热（i3/i5 等）             │
│     - 保留原装风扇                   │
│     - 确保进风口不被遮挡             │
│     - 出风口朝向机器人外部           │
│                                     │
│  3. 温度监控                         │
│     - 安装 lm-sensors               │
│     - 设置温度报警                   │
└─────────────────────────────────────┘
```

### L298N 散热

```
L298N 在大电流时会发热：
- 加装散热片（通常已自带）
- 确保周围通风
- 避免长时间堵转
```

---

## 🔌 理线规范

```
理线原则：
┌─────────────────────────────────────┐
│  1. 电源线和信号线分开走             │
│                                     │
│  2. 用扎带固定，避免松动             │
│                                     │
│  3. 预留适当长度，方便维护           │
│                                     │
│  4. 接头处做好标记                   │
│                                     │
│  5. 关键接头用热缩管保护             │
└─────────────────────────────────────┘
```

---

## ✅ 装配后测试

### 测试清单

| 测试项 | 命令/操作 | 预期结果 | 状态 |
|--------|-----------|----------|------|
| 串口连接 | 发送 `PING` | 收到 `PONG` | □ |
| 前进 | 发送 `F,500` | 小车前进 | □ |
| 后退 | 发送 `B,500` | 小车后退 | □ |
| 左转 | 发送 `L,300` | 小车左转 | □ |
| 右转 | 发送 `R,300` | 小车右转 | □ |
| 停止 | 发送 `S` | 小车停止 | □ |
| 超声波 | 发送 `SENSOR` | 收到距离数据 | □ |
| 舵机 | 发送 `SERVO,90` | 舵机转到中间 | □ |
| 蜂鸣器 | 发送 `BEEP` | 响一声 | □ |

### 测试命令

```bash
# 启动后端
node server/index.js

# 测试前进
curl -X POST http://localhost:3001/api/hardware/motion \
  -H "Content-Type: application/json" \
  -d '{"action":"move","data":{"direction":"forward"}}'

# 测试传感器
curl http://localhost:3001/api/hardware/sensors

# 测试自主避障
curl -X POST http://localhost:3001/api/autonomy \
  -H "Content-Type: application/json" \
  -d '{"action":"start","mode":"exploring"}'
```

---

## ⚠️ 常见问题

### 1. 电机不转

| 可能原因 | 解决方法 |
|----------|----------|
| 电池没电 | 更换电池 |
| 接线错误 | 检查 IN1-IN4 接线 |
| L298N 损坏 | 更换驱动板 |
| STM32 程序问题 | 重新烧录固件 |

### 2. 串口无响应

| 可能原因 | 解决方法 |
|----------|----------|
| COM 口错误 | 检查设备管理器 |
| 波特率不对 | 设置为 115200 |
| TX/RX 接反 | 交换接线 |
| DTR/RTS 干扰 | 后端已自动处理 |

### 3. 超声波数据异常

| 可能原因 | 解决方法 |
|----------|----------|
| 接线错误 | 检查 TRIG/ECHO |
| 供电不足 | 确保 5V 供电 |
| 遮挡物太近 | 最小测距 2cm |
| 软物体 | 超声波对软物体反射差 |

---

## 🔗 相关文档

- [07-software-integration.md](./07-software-integration.md) - 软硬件集成
- [../stm32-serial-protocol.md](../stm32-serial-protocol.md) - 串口协议
