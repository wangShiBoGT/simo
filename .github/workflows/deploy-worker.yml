# Cloudflare Worker 自动部署
# 当 worker/ 目录有变更时自动部署到 Cloudflare
#
# 需要在 GitHub 仓库设置中添加 Secret：
# - CLOUDFLARE_API_TOKEN: Cloudflare API Token
# - CLOUDFLARE_ACCOUNT_ID: Cloudflare 账户 ID
#
# 获取方式：
# 1. 登录 https://dash.cloudflare.com
# 2. 点击右上角头像 → My Profile → API Tokens
# 3. 创建 Token，选择 "Edit Cloudflare Workers" 模板
# 4. 账户 ID 在 Workers 页面右侧可以看到

name: Deploy Worker

on:
  push:
    branches:
      - main
    paths:
      - 'worker/**'  # 只有 worker 目录变更时才触发

  # 允许手动触发
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Cloudflare Workers

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Wrangler
        run: npm install -g wrangler

      - name: Deploy Worker
        working-directory: ./worker
        run: npx wrangler deploy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
